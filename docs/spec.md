# TONIX Lottery ‚Äî Smart Contract Specification v1.0

## Mainnet Deployment

**Contract Address:** `EQBtB8vIHgdO49Ih02Yt9kD5tDKxOTrFgZHkRkAjFTrvJziT`  
üîó **TonViewer:** https://tonviewer.com/EQBtB8vIHgdO49Ih02Yt9kD5tDKxOTrFgZHkRkAjFTrvJziT  
üîó **Tonscan:** https://tonscan.org/address/EQBtB8vIHgdO49Ih02Yt9kD5tDKxOTrFgZHkRkAjFTrvJziT

**Deployed:** 2025-10-31  
**Network:** Mainnet TON  
**Code Hash:** `f877b94c252a86285dc6f152c33f268474c21d0570e71f3762af339889209ed6`

---

## –û–ø–∏—Å–∞–Ω–∏–µ

Production-grade —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ª–æ—Ç–µ—Ä–µ–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TON, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –Ω–∞ —è–∑—ã–∫–µ Tact. –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –ª–æ—Ç–µ—Ä–µ—é —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

- `owner: Address` ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- `ticketPrice: Int as coins` ‚Äî —Ü–µ–Ω–∞ –æ–¥–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞
- `participants: map<Int, Address>` ‚Äî —Å–ª–æ–≤–∞—Ä—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–∏–Ω–¥–µ–∫—Å ‚Üí –∞–¥—Ä–µ—Å)
- `participantCount: Int` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `pool: Int as coins` ‚Äî —Ç–µ–∫—É—â–∏–π –ø—É–ª –ø—Ä–∏–∑–æ–≤
- `roundActive: Bool` ‚Äî –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥
- `winner: Address?` ‚Äî –ø–æ–±–µ–¥–∏—Ç–µ–ª—å —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞ (null –µ—Å–ª–∏ –Ω–µ—Ç)
- `winnerCanClaim: Bool` ‚Äî –º–æ–∂–µ—Ç –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –∑–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑

### –°–æ–æ–±—â–µ–Ω–∏—è

1. **BuyTicket** ‚Äî –ø–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞
   - –¢—Ä–µ–±—É–µ—Ç: `context().value == ticketPrice`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω, —É—á–∞—Å—Ç–Ω–∏–∫ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ
   - –û–±–Ω–æ–≤–ª—è–µ—Ç: –¥–æ–±–∞–≤–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç pool

2. **DrawWinner** ‚Äî —Ä–æ–∑—ã–≥—Ä—ã—à –ø–æ–±–µ–¥–∏—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ owner)
   - –¢—Ä–µ–±—É–µ—Ç: —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω, –µ—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∏
   - –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —á–µ—Ä–µ–∑ `random(0, participantCount)`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è, –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞—É–Ω–¥

3. **ClaimPrize** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–∏–≥—Ä—ã—à–∞
   - –¢—Ä–µ–±—É–µ—Ç: –µ—Å—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—å, –ø—Ä–∏–∑ –¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã–∑—ã–≤–∞—é—â–∏–π ‚Äî –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
   - –ó–∞—â–∏—Ç–∞ –æ—Ç reentrancy: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `winnerCanClaim = false` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Å—å –±–∞–ª–∞–Ω—Å (–∫—Ä–æ–º–µ —Ä–µ–∑–µ—Ä–≤–∞ 0.05 TON)

4. **ResetRound** ‚Äî —Å–±—Ä–æ—Å —Ä–∞—É–Ω–¥–∞ (—Ç–æ–ª—å–∫–æ owner)
   - –¢—Ä–µ–±—É–µ—Ç: —Ä–∞—É–Ω–¥ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–∏–∑ –∑–∞–±—Ä–∞–Ω (–µ—Å–ª–∏ –±—ã–ª)
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç: —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ø—É–ª, —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—É–Ω–¥–∞

5. **EmergencyWithdraw** ‚Äî —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ (—Ç–æ–ª—å–∫–æ owner)
   - –¢—Ä–µ–±—É–µ—Ç: —Ä–∞—É–Ω–¥ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–∏–∑ –∑–∞–±—Ä–∞–Ω
   - –í—ã–≤–æ–¥–∏—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –∞–¥—Ä–µ—Å –≤–ª–∞–¥–µ–ª—å—Ü–∞

### Getter —Ñ—É–Ω–∫—Ü–∏–∏

- `getTicketPrice()` ‚Äî —Ü–µ–Ω–∞ –±–∏–ª–µ—Ç–∞
- `getParticipantCount()` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `getPool()` ‚Äî —Ç–µ–∫—É—â–∏–π –ø—É–ª
- `getRoundActive()` ‚Äî –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ä–∞—É–Ω–¥
- `getWinner()` ‚Äî –ø–æ–±–µ–¥–∏—Ç–µ–ª—å (null –µ—Å–ª–∏ –Ω–µ—Ç)
- `getWinnerCanClaim()` ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –ø—Ä–∏–∑
- `getOwner()` ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã

1. **Ownable** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —á–µ—Ä–µ–∑ `requireOwner()`
2. **Anti-reentrancy** ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å—Ä–µ–¥—Å—Ç–≤
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã** ‚Äî —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ `ticketPrice`
4. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
5. **–†–µ–∑–µ—Ä–≤ –≥–∞–∑–∞** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ 0.05 TON –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫

- `21547` ‚Äî Incorrect ticket price
- `59137` ‚Äî Already participating in this round
- `47697` ‚Äî Round is not active
- `39078` ‚Äî No participants
- `43564` ‚Äî Only winner can claim
- `45748` ‚Äî Prize already claimed or not available
- `50778` ‚Äî Round is still active
- `42251` ‚Äî Cannot withdraw during active round
- `132` ‚Äî Access denied (Ownable)

## –î–µ–ø–ª–æ–π

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `npm install`
2. –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å: `npx blueprint build TonixLottery`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã: `npx vitest run`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞—Ç—å `.env`:

```
MNEMONIC="word1 word2 ... word24"
TICKET_PRICE="1"
TONCENTER_API_KEY="your_api_key"
```

### –î–µ–ø–ª–æ–π –≤ mainnet

```bash
cd contracts
npx tsx scripts/deploy.ts
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- –ê–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –≤ Tonviewer: `https://tonviewer.com/{address}`
- –ê–¥—Ä–µ—Å –≤ Tonscan: `https://tonscan.org/address/{address}`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Sandbox:

```bash
npx vitest run tests/TonixLottery.spec.ts
```

–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ –î–µ–ø–ª–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- ‚úÖ –ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –†–æ–∑—ã–≥—Ä—ã—à –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–∑–∞
- ‚úÖ –°–±—Ä–æ—Å —Ä–∞—É–Ω–¥–∞
- ‚úÖ –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥

## CI/CD

GitHub Actions workflow:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∏–ª–¥ –ø—Ä–∏ push –≤ `main`
- –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- –î–µ–ø–ª–æ–π –≤ mainnet (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –∏–ª–∏ push –≤ main)

## –ê—É–¥–∏—Ç

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∞—É–¥–∏—Ç—É TON Society:
- ‚úÖ –í—Å–µ require —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç reentrancy
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º

